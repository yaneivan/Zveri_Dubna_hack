# КОТ - Координационный Оперативный Трекер

#### [Презентация](КОТ.pptx)

Телеграм бот, который помогает найти пропавших животных.

## Содержание

- [Описание](#описание)
- [Установка](#установка)
- [Использование](#использование)
- [Стек](#Стек)
- [Команда](#команда)
- [Монетезация](#Монетезация)
- [Планы на будущее](#планы-на-будущее)
- [Контакты](#контакты)

## Описание

Этот бот дает возможность быстро получить информаицию о животном. Иногда бывает, что на улице можно заметить животное, которое выглядит домашним. Этот бот предоставляет возможность быстро получить информацию о животном, сверяя его с базой данных. 
Сравнение происходит по фотографии, описанию и координатам. То есть вы можете сфотографировать животное, отправить боту, и он скажет вам, потерялось оно или просто гуляет.

База собирается с сайта pet911.ru. Это делает файл parse.ipynb. Там реализован парсер на selenium. Данные сохраняются в файл links.csv. Сохраняются ссылки на объявления, изображения, заголовки, описания, широта, долгота, адреса, типы животных и их статус (Потерялся/Найден). Широту и долготу он находит через API openstreetmap.org, это бесплатно, но только один запрос в секунду.

## Установка

Инструкции по установке проекта:
1. Клонировать репозиторий:
   ```bash
   git clone https://github.com/yaneivan/Zveri_Dubna_hack
   ```
2. Перейти в директорию проекта:
   ```bash
   cd Zveri_Dubna_hack
   ```
3. Установить зависимости:
   ```bash
   pip install -r requirements.txt
   ```

Нужны ключи для телеграм бота, и для LLM модели. Они задаются в файле bot.py, на 226 и 26 строках соответственно. Я вам оставлю свои, но вы их можете заменить если нужно. (Ключи от LLM бесплатные, можете пользоваться моими)
(Ссылка на tg бота @tyh_test_bot)((Но лучше поменяйте на своего))
LLM модель - Mistral, API ключ дают у них на сайте, https://console.mistral.ai/ 
Доступ к их моделям бесплатный, но есть Rate Limit, ключ дают если зайти через гугл аккаунт. Работает без VPN. 

Впринципе это все, должно работать. 

## Использование

Для работы телеграм бота нужно иметь базу животных. Она создается парсером, в первой ячейке блокнота parse.ipynb.
После создания базы нужно запустить бот, который реализован в файле bot.py.
В файле Process_request.ipynb лежит прототип логики работы бота.
Итоговая логика:
1. Пользователь отправляет боту описание животного, его фотографии и местоположение.
2. Бот извлекает данные из сообщения (тип животного, статус, адрес, описание, опционально фото)
3. Адрес передается в API openstreetmap.org. В ответ приходят координаты этого адреса. 
4. Из базы данных берутся объявления, которые могут относиться этому запросу (то есть если у нас запрос "пропала собака", то ищем в базе только "найдена собака").
5. Эти объявления сортируются по расстоянию до координат, которые указал пользователь.
6. Некоторое количество ближайших записей отправляется в мультимодальную LLM модель, чтобы она сравнила описание и фотографии животного из запроса, с тем что есть в базе. 
7. Если LLM модель считает, что это животное есть в базе, то бот отправляет пользователю эту запись. 

В боте есть возможность обрабатывать несколько запросов одновременно, но поскольку у бесплатных LLM ограничение по количеству одновременных запросов, пользователи обрабатываются по очереди. 

## Стек

Список технологий и инструментов, использованных в проекте:
- Python
- Selenium, telebot, pandas, 
- Mistral LLM API
- VSCode, Cursor, ChatGPT

Поскольку доступ к LLM модели идет через API, то эта система может быть развернута практически на любом устройстве. Самая тяжелая часть, это пожалуй парсер. Для всей разработки и тестирования использовался один ноутбук. 

## Команда

Список участников команды с их ролями:
- Бабкин Антон 3252 - Парсер, Бот, прототип с Florence2
- Сергей - Разработчик

## Монетезация
Монетизации в этом проекте нет, и не планируется. 
Мне кажется это неправильно, и так делать не стоит. 

## Планы на будущее
Хотелось бы сделать свою модель для сравнения животных, вместо использования LLM. 

Например есть библиотека DLIB, которая умеет находить ключевые точки на мордочках собак.

Есть датасет https://universe.roboflow.com/brad-dwyer/oxford-pets 
Это датасет для Detection мордочек у кошек и собак, и разделения их на породы. 

Три датасета по одной ссылке: https://zenodo.org/records/12578449
DogFaceNet_large - фотографии собак в полный рост. 2500 папок, в каждой папке фотографии одной собаки. 
DogFaceNet_alignment - тут размечены ключевые точки на мордочках собак, два глаза и нос.
DogFaceNet_224resized - 1400 папок, в каждой папке фотографии мордочки одной собаки. 

Хотелось бы сделать модель, которая сможет сравнить две мордочки и сказать, одна ли это собака, или разные. Это сильно ускорит обработку запросов. 
Для этого можно было бы использовать архитектуру Сиамской нейронной сети. То есть сначала обе картинки проходят через одни и те же слои, а потом результаты подаются в линейный слой. У линейного слоя один выход. 0 - разные, 1 - одинаковые.
Отлично получится обучаться на данных DogFaceNet_224resized. 
Также подойдут данные которые мы парсим с сайта. Ведь в одном объявлении у нас будет одно и то же животное. Поэтому мы можем использовать эти фотографии для обучения. 

Начало работы над этим проектом находится в файле detect_face.ipynb.
Там я использую нейросеть Florence 2, для детекции мордочки животных. Эта нейросеть для работы с картинками, но ее можно промптить. 
(Эта модель достаточно тяжелая, 0.8B параметров large вариант, на ноутбуке один запрос выполнялся 30 минут, поэтому нужно будет использовать GPU, либо Google Colab. На GTX 1660Super один прогон изображения занял 6 секунд)
К сожалению у меня получилось много некачественных картинок. 
Я не успел решить эту проблему, и перешел к работе над ботом. 

## Контакты
На всякий случай

Антон:
tg - @ya_ne_ivan
email - anton.epub@gmail.com
